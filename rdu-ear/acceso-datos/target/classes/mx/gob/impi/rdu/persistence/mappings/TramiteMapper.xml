<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mx.gob.impi.rdu.persistence.mappers.TramiteMapper" >
    <resultMap id="BaseResultMap" type="mx.gob.impi.rdu.persistence.model.Tramite" >
        <id column="ID_TRAMITE" property="idTramite" jdbcType="DECIMAL" />
        <result column="ID_SUBTIPOSOLICITUD" property="idSubtiposolicitud" jdbcType="DECIMAL" />
        <result column="ID_TIPOMARCA" property="idTipomarca" jdbcType="DECIMAL" />
        <result column="MARCACOLECTIVA" property="marcacolectiva" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONSIGNODISTINTIVO" property="descripcionsignodistintivo" jdbcType="VARCHAR" />
        <result column="FECHAPRIMERUSO" property="fechaprimeruso" jdbcType="TIMESTAMP" />
        <result column="NOUSADOFECHA" property="nousadofecha" jdbcType="DECIMAL" />
        <result column="LEYENDASFIGURASRESERVABLES" property="leyendasfigurasreservables" jdbcType="VARCHAR" />
        <result column="ID_DOMICILIONOTIFICACION" property="idDomicilionotificacion" jdbcType="DECIMAL" />
        <result column="ID_PAISPRIORIDAD" property="idPaisprioridad" jdbcType="DECIMAL" />
        <result column="FECHAPRESENTACIONEXTRANJERO" property="fechapresentacionextranjero" jdbcType="TIMESTAMP" />
        <result column="ID_ESTATUS" property="idEstatus" jdbcType="DECIMAL" />
        <result column="FECHA_ESTATUS_ACTUAL" property="fechaEstatusActual" jdbcType="TIMESTAMP" />
        <result column="ID_USUARIOFIRMANTE" property="idUsuariofirmante" jdbcType="DECIMAL" />
        <result column="NUMEROEXPEDIENTE" property="numeroexpediente" jdbcType="VARCHAR" />
        <result column="FECHARECEPCION" property="fecharecepcion" jdbcType="TIMESTAMP" />
        <result column="FECHAPRESENTACION" property="fechapresentacion" jdbcType="TIMESTAMP" />
        <result column="FECHACAPTURA" property="fechacaptura" jdbcType="TIMESTAMP" />
        <result column="NUMEROREFEXTRANJERO" property="numerorefextranjero" jdbcType="VARCHAR" />
        <result column="ID_USUARIOCAPTURA" property="idUsuariocaptura" jdbcType="DECIMAL" />
        <result column="IND_ACTIVO" property="indActivo" jdbcType="DECIMAL" />
        <result column="CONOCECLASE" property="conoceClase" jdbcType="DECIMAL" />
        <result column="HAYPRIORIDAD" property="hayPrioridad" jdbcType="DECIMAL" />
        <result column="HAYESTABLECIMIENTO" property="hayEstablecimiento" jdbcType="DECIMAL" />
        <result column="FECHA_REVISION" property="fechaRevision" jdbcType="TIMESTAMP" />

    </resultMap>

    <resultMap id="SimpleResultMap" type="mx.gob.impi.rdu.persistence.model.Tramite" >
        <id column="ID_TRAMITE" property="idTramite" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONSIGNODISTINTIVO" property="descripcionsignodistintivo" jdbcType="VARCHAR" />
        <result column="SUBTIPO" property="subTipoSolicitud.descripcion" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="BaseResultExpediente" type="mx.gob.impi.rdu.dto.ExpedientesDto" >
        <result column="ID_TRAMITE" property="idTramite" jdbcType="DECIMAL" />
        <result column="ID_FIRMA" property="idFirma" jdbcType="DECIMAL" />
        <result column="FOLIO" property="folio" jdbcType="VARCHAR" />
        <result column="EXPEDIENTE" property="expediente" jdbcType="DECIMAL" />
        <result column="FECHA_PRESENTACION" property="fechaPresentacion" jdbcType="TIMESTAMP" />
        <result column="FECHA_REGISTRO" property="fechaRegistro" jdbcType="TIMESTAMP" />
        <result column="ANEXO_XML" property="anexoXml" jdbcType="BLOB" />
        <result column="ACUSE_PDF" property="acusePdf" jdbcType="BLOB" />
        <result column="SUBTIPOSOLICITUD" property="subTipoSolicitud" jdbcType="VARCHAR" />
        <result column="ID_SUBTIPOSOLICITUD" property="idSubtiposolicitud" jdbcType="DECIMAL" />
        <result column="TIPOSOLICITUD" property="tipoSolicitud" jdbcType="VARCHAR" />
        <result column="AREA" property="area" jdbcType="VARCHAR" />
        <result column="ARCHIVO_ANEXO" property="acuseLogo" jdbcType="BLOB" />
        <result column="ID_TIPOMARCA" property="idTipomarca" jdbcType="DECIMAL" />
        <result column="FECHA_REVISION" property="fechaRevision" jdbcType="TIMESTAMP" />
        <result column="EXISTE_ACUSE_PDF" property="existeAcusePdf"/>
        <result column="EXISTE_ACUSE_LOGO" property="existeAcuseLogo"/>
        <result column="ENVIO_SIGMAR" property="envioSIGMAR" jdbcType="DECIMAL" />
        <result column="FECHA_ENVIO_SIGMAR" property="fechaEnvioSIGMAR" jdbcType="TIMESTAMP"/>
        <result column="ENVIO_UCM" property="envioUCM" jdbcType="DECIMAL" />
        <result column="FECHA_ENVIO_UCM" property="fechaEnvioUCM" jdbcType="TIMESTAMP"/>

    </resultMap>

    <resultMap id="BaseResultTest" type="mx.gob.impi.rdu.dto.ExpedientesDto" >
        <result column="ID_TRAMITE" property="idTramite" jdbcType="DECIMAL" />
    </resultMap>

    <resultMap id="BaseResultSolicitudesPreparacion" type="mx.gob.impi.rdu.dto.SolicitudPreparacionDto" >
        <result column="ID_TRAMITE" property="idTramite" jdbcType="DECIMAL" />
        <result column="ID_AREA" property="idArea" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONAREA" property="descripcionArea" jdbcType="VARCHAR" />
        <result column="ID_SUBTIPOSOLICITUD" property="idSubtiposolicitud" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONSUBTIPOSOLICITUD" property="descripcionSubtiposolicitud" jdbcType="VARCHAR" />
        <result column="ID_TIPOSOLICITUD" property="idTiposolicitud" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONTIPOSOLICITUD" property="descripcionTiposolicitud" jdbcType="VARCHAR" />
        <result column="URL_TIPOSOLICITUD" property="url_TipoSolicitud" jdbcType="VARCHAR" />
        <result column="FECHACAPTURA" property="fechacaptura" jdbcType="TIMESTAMP" />
        <result column="FECHA_ESTATUS_ACTUAL" property="fechaEstatusActual" jdbcType="TIMESTAMP" />
        <result column="ID_USUARIOCAPTURA" property="idUsuariocaptura" jdbcType="DECIMAL" />
        <result column="ID_USUARIOFIRMANTE" property="idUsuariofirmante" jdbcType="DECIMAL" />
        <result column="ID_ESTATUS" property="idEstatus" jdbcType="DECIMAL" />
        <result column="DESESTATUS" property="descripcionESTATUS" jdbcType="VARCHAR" />
        <result column="SIGACCION" property="sigaccion" jdbcType="VARCHAR" />
        <result column="URL_SIG_ACCION_ESTATUS" property="url_SigAccion_Estatus" jdbcType="VARCHAR" />
        <result column="ID_TIPOMARCA" property="idTipomarca" jdbcType="DECIMAL" />
        <result column="DESCRIPCIONSIGNODISTINTIVO" property="descripcionsignodistintivo" jdbcType="VARCHAR" />
        <result column="HAYPRIORIDAD" property="hayprioridad" jdbcType="DECIMAL" />
        <result column="TOT_SOLICITANTES" property="totalSolicitantes" jdbcType="DECIMAL" />
        <result column="ID_TIPOTRAMITE" property="idTipoTramite" jdbcType="DECIMAL" />
    </resultMap>
    
    <resultMap id="BaseResulArchivoDigital" type="mx.gob.impi.rdu.dto.ArchivoDigitalDto" >
        <result column="ARCHIVO" property="archivo" jdbcType="BLOB"/>
    </resultMap>
    
    <select id="selectsecuencia" resultType="java.lang.Integer">
        SELECT ACUSE_SEQ.NextVal AS ID_TRAMITE FROM DUAL
    </select>

    <select id="selectDatosBasicos" resultMap="SimpleResultMap" parameterType="long">
        SELECT
          A.ID_TRAMITE ID_TRAMITE,
          A.DESCRIPCIONSIGNODISTINTIVO DESCRIPCIONSIGNODISTINTIVO,
          CS.DESCRIPCION SUBTIPO
        from TRAMITE A
        INNER JOIN CAT_SUBTIPOSOLICITUD CS ON(CS.ID_SUBTIPOSOLICITUD=A.ID_SUBTIPOSOLICITUD)
        WHERE A.IND_ACTIVO=1 AND A.ID_TRAMITE=#{idTramite,jdbcType=DECIMAL}
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select
    ID_TRAMITE, ID_SUBTIPOSOLICITUD, ID_TIPOMARCA, MARCACOLECTIVA, DESCRIPCIONSIGNODISTINTIVO,
    FECHAPRIMERUSO, NOUSADOFECHA, LEYENDASFIGURASRESERVABLES, ID_DOMICILIONOTIFICACION,
    ID_PAISPRIORIDAD, FECHAPRESENTACIONEXTRANJERO, ID_ESTATUS, FECHA_ESTATUS_ACTUAL, ID_USUARIOFIRMANTE, NUMEROEXPEDIENTE,
    FECHARECEPCION, FECHAPRESENTACION, FECHACAPTURA, NUMEROREFEXTRANJERO, ID_USUARIOCAPTURA,IND_ACTIVO,
    CONOCECLASE, HAYPRIORIDAD, HAYESTABLECIMIENTO
    from TRAMITE
    where IND_ACTIVO=1 AND ID_TRAMITE = #{idTramite,jdbcType=DECIMAL}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from TRAMITE
    where ID_TRAMITE = #{idTramite,jdbcType=DECIMAL}
    </delete>

    <insert id="insert" parameterType="mx.gob.impi.rdu.persistence.model.Tramite"  >

        <selectKey resultType="long" keyProperty="idTramite" order="AFTER">
        SELECT TRAMITE_SEQ.currVal AS ID FROM DUAL
        </selectKey>
    insert into TRAMITE (ID_TRAMITE, ID_SUBTIPOSOLICITUD, ID_TIPOMARCA,
      MARCACOLECTIVA, DESCRIPCIONSIGNODISTINTIVO, 
      FECHAPRIMERUSO, NOUSADOFECHA, LEYENDASFIGURASRESERVABLES, 
      ID_DOMICILIONOTIFICACION, ID_PAISPRIORIDAD, 
      FECHAPRESENTACIONEXTRANJERO, ID_ESTATUS, 
      ID_USUARIOFIRMANTE, NUMEROEXPEDIENTE, FECHARECEPCION, 
      FECHAPRESENTACION, FECHACAPTURA, NUMEROREFEXTRANJERO, 
      ID_USUARIOCAPTURA,IND_ACTIVO,CONOCECLASE, HAYPRIORIDAD, HAYESTABLECIMIENTO,FECHA_ESTATUS_ACTUAL)
    values (TRAMITE_SEQ.NEXTVAL, #{idSubtiposolicitud,jdbcType=DECIMAL}, #{idTipomarca,jdbcType=DECIMAL},
      #{marcacolectiva,jdbcType=DECIMAL}, #{descripcionsignodistintivo,jdbcType=VARCHAR}, 
      #{fechaprimeruso,jdbcType=TIMESTAMP}, #{nousadofecha,jdbcType=DECIMAL}, #{leyendasfigurasreservables,jdbcType=VARCHAR}, 
      #{idDomicilionotificacion,jdbcType=DECIMAL}, #{idPaisprioridad,jdbcType=DECIMAL}, 
      #{fechapresentacionextranjero,jdbcType=TIMESTAMP}, #{idEstatus,jdbcType=DECIMAL}, 
      #{idUsuariofirmante,jdbcType=DECIMAL}, #{numeroexpediente,jdbcType=VARCHAR}, #{fecharecepcion,jdbcType=TIMESTAMP}, 
      #{fechapresentacion,jdbcType=TIMESTAMP}, SYSDATE, #{numerorefextranjero,jdbcType=VARCHAR},
      #{idUsuariocaptura,jdbcType=DECIMAL},#{indActivo,jdbcType=DECIMAL},#{conoceClase,jdbcType=DECIMAL},
      #{hayPrioridad,jdbcType=DECIMAL},#{hayEstablecimiento,jdbcType=DECIMAL},SYSDATE)
    </insert>
    <insert id="insertSelective" parameterType="mx.gob.impi.rdu.persistence.model.Tramite" >
    insert into TRAMITE
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="idTramite != null" >
        ID_TRAMITE,
            </if>
            <if test="idSubtiposolicitud != null" >
        ID_SUBTIPOSOLICITUD,
            </if>
            <if test="idTipomarca != null" >
        ID_TIPOMARCA,
            </if>
            <if test="marcacolectiva != null" >
        MARCACOLECTIVA,
            </if>
            <if test="descripcionsignodistintivo != null" >
        DESCRIPCIONSIGNODISTINTIVO,
            </if>
            <if test="fechaprimeruso != null" >
        FECHAPRIMERUSO,
            </if>
            <if test="nousadofecha != null" >
        NOUSADOFECHA,
            </if>
            <if test="leyendasfigurasreservables != null" >
        LEYENDASFIGURASRESERVABLES,
            </if>
            <if test="idDomicilionotificacion != null" >
        ID_DOMICILIONOTIFICACION,
            </if>
            <if test="idPaisprioridad != null" >
        ID_PAISPRIORIDAD,
            </if>
            <if test="fechapresentacionextranjero != null" >
        FECHAPRESENTACIONEXTRANJERO,
            </if>
            <if test="idEstatus != null" >
        ID_ESTATUS,
            </if>
            <if test="idUsuariofirmante != null" >
        ID_USUARIOFIRMANTE,
            </if>
            <if test="numeroexpediente != null" >
        NUMEROEXPEDIENTE,
            </if>
            <if test="fecharecepcion != null" >
        FECHARECEPCION,
            </if>
            <if test="fechapresentacion != null" >
        FECHAPRESENTACION,
            </if>
            <if test="fechacaptura != null" >
        FECHACAPTURA,
            </if>
            <if test="numerorefextranjero != null" >
        NUMEROREFEXTRANJERO,
            </if>
            <if test="idUsuariocaptura != null" >
        ID_USUARIOCAPTURA,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="idTramite != null" >
        #{idTramite,jdbcType=DECIMAL},
            </if>
            <if test="idSubtiposolicitud != null" >
        #{idSubtiposolicitud,jdbcType=DECIMAL},
            </if>
            <if test="idTipomarca != null" >
        #{idTipomarca,jdbcType=DECIMAL},
            </if>
            <if test="marcacolectiva != null" >
        #{marcacolectiva,jdbcType=DECIMAL},
            </if>
            <if test="descripcionsignodistintivo != null" >
        #{descripcionsignodistintivo,jdbcType=VARCHAR},
            </if>
            <if test="fechaprimeruso != null" >
        #{fechaprimeruso,jdbcType=TIMESTAMP},
            </if>
            <if test="nousadofecha != null" >
        #{nousadofecha,jdbcType=DECIMAL},
            </if>
            <if test="leyendasfigurasreservables != null" >
        #{leyendasfigurasreservables,jdbcType=VARCHAR},
            </if>
            <if test="idDomicilionotificacion != null" >
        #{idDomicilionotificacion,jdbcType=DECIMAL},
            </if>
            <if test="idPaisprioridad != null" >
        #{idPaisprioridad,jdbcType=DECIMAL},
            </if>
            <if test="fechapresentacionextranjero != null" >
        #{fechapresentacionextranjero,jdbcType=TIMESTAMP},
            </if>
            <if test="idEstatus != null" >
        #{idEstatus,jdbcType=DECIMAL},
            </if>
            <if test="idUsuariofirmante != null" >
        #{idUsuariofirmante,jdbcType=DECIMAL},
            </if>
            <if test="numeroexpediente != null" >
        #{numeroexpediente,jdbcType=VARCHAR},
            </if>
            <if test="fecharecepcion != null" >
        #{fecharecepcion,jdbcType=TIMESTAMP},
            </if>
            <if test="fechapresentacion != null" >
        #{fechapresentacion,jdbcType=TIMESTAMP},
            </if>
            <if test="fechacaptura != null" >
        #{fechacaptura,jdbcType=TIMESTAMP},
            </if>
            <if test="numerorefextranjero != null" >
        #{numerorefextranjero,jdbcType=VARCHAR},
            </if>
            <if test="idUsuariocaptura != null" >
        #{idUsuariocaptura,jdbcType=DECIMAL},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="mx.gob.impi.rdu.persistence.model.Tramite" >
        update TRAMITE
        <set >
            <if test="idSubtiposolicitud != null" >
                ID_SUBTIPOSOLICITUD =#{idSubtiposolicitud,jdbcType=DECIMAL},
            </if>
            <if test="idTipomarca != null" >
          ID_TIPOMARCA= #{idTipomarca,jdbcType=DECIMAL},
            </if>
            <if test="marcacolectiva != null" >
                MARCACOLECTIVA= #{marcacolectiva,jdbcType=DECIMAL},
            </if>
            <if test="descripcionsignodistintivo != null" >
                DESCRIPCIONSIGNODISTINTIVO= #{descripcionsignodistintivo,jdbcType=VARCHAR},
            </if>
            <if test="fechaprimeruso != null" >
                FECHAPRIMERUSO= #{fechaprimeruso,jdbcType=TIMESTAMP},
            </if>
            <if test="nousadofecha != null" >
                NOUSADOFECHA= #{nousadofecha,jdbcType=DECIMAL},
            </if>
            <if test="leyendasfigurasreservables != null" >
                LEYENDASFIGURASRESERVABLES= #{leyendasfigurasreservables,jdbcType=VARCHAR},
            </if>
            <if test="idDomicilionotificacion != 0" >
            ID_DOMICILIONOTIFICACION = #{idDomicilionotificacion,jdbcType=DECIMAL},
            </if>
            <if test="idPaisprioridad != null" >
            ID_PAISPRIORIDAD = #{idPaisprioridad,jdbcType=DECIMAL},
            </if>
            <if test="fechapresentacionextranjero != null" >
            FECHAPRESENTACIONEXTRANJERO = #{fechapresentacionextranjero,jdbcType=TIMESTAMP},
            </if>
            <if test="idEstatus != null" >
            ID_ESTATUS = #{idEstatus,jdbcType=DECIMAL},
            </if>
            <if test="idUsuariofirmante != null" >
            ID_USUARIOFIRMANTE = #{idUsuariofirmante,jdbcType=DECIMAL},
            </if>
            <if test="numeroexpediente != null" >
            NUMEROEXPEDIENTE = #{numeroexpediente,jdbcType=VARCHAR},
            </if>
            <if test="fecharecepcion != null" >
            FECHARECEPCION = #{fecharecepcion,jdbcType=TIMESTAMP},
            </if>
            <if test="fechapresentacion != null" >
            FECHAPRESENTACION = #{fechapresentacion,jdbcType=TIMESTAMP},
            </if>
            <if test="fechacaptura != null" >
            FECHACAPTURA = #{fechacaptura,jdbcType=TIMESTAMP},
            </if>
            <if test="numerorefextranjero != null" >
            NUMEROREFEXTRANJERO = #{numerorefextranjero,jdbcType=VARCHAR},
            </if>
            <if test="idUsuariocaptura != null" >
            ID_USUARIOCAPTURA = #{idUsuariocaptura,jdbcType=DECIMAL},
            </if>
            <if test="indActivo != null" >
                IND_ACTIVO = #{indActivo,jdbcType=DECIMAL},
            </if>
            <if test="fechaEstatusActual != null" >
                FECHA_ESTATUS_ACTUAL = SYSDATE
            </if>
        </set>
    where ID_TRAMITE = #{idTramite,jdbcType=DECIMAL}
    </update>
    <update id="updateByPrimaryKey" parameterType="mx.gob.impi.rdu.persistence.model.Tramite" >
    update TRAMITE
    set ID_SUBTIPOSOLICITUD = #{idSubtiposolicitud,jdbcType=DECIMAL},
      ID_TIPOMARCA = #{idTipomarca,jdbcType=DECIMAL},
      MARCACOLECTIVA = #{marcacolectiva,jdbcType=DECIMAL},
      DESCRIPCIONSIGNODISTINTIVO = #{descripcionsignodistintivo,jdbcType=VARCHAR},
      FECHAPRIMERUSO = #{fechaprimeruso,jdbcType=TIMESTAMP},
      NOUSADOFECHA = #{nousadofecha,jdbcType=DECIMAL},
      LEYENDASFIGURASRESERVABLES = #{leyendasfigurasreservables,jdbcType=VARCHAR},
      ID_DOMICILIONOTIFICACION = #{idDomicilionotificacion,jdbcType=DECIMAL},
      ID_PAISPRIORIDAD = #{idPaisprioridad,jdbcType=DECIMAL},
      FECHAPRESENTACIONEXTRANJERO = #{fechapresentacionextranjero,jdbcType=TIMESTAMP},
      ID_ESTATUS = #{idEstatus,jdbcType=DECIMAL},
      ID_USUARIOFIRMANTE = #{idUsuariofirmante,jdbcType=DECIMAL},
      NUMEROEXPEDIENTE = #{numeroexpediente,jdbcType=VARCHAR},
      FECHARECEPCION = #{fecharecepcion,jdbcType=TIMESTAMP},
      FECHAPRESENTACION = #{fechapresentacion,jdbcType=TIMESTAMP},
      NUMEROREFEXTRANJERO = #{numerorefextranjero,jdbcType=VARCHAR},
      ID_USUARIOCAPTURA = #{idUsuariocaptura,jdbcType=DECIMAL} ,
      CONOCECLASE= #{conoceClase,jdbcType=DECIMAL} ,
      HAYPRIORIDAD= #{hayPrioridad,jdbcType=DECIMAL} ,
      HAYESTABLECIMIENTO= #{hayEstablecimiento,jdbcType=DECIMAL},
      FECHA_ESTATUS_ACTUAL=SYSDATE
    where ID_TRAMITE = #{idTramite,jdbcType=DECIMAL}
    </update>
    
    <select id="selectByUsuario" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select
    ID_TRAMITE, ID_SUBTIPOSOLICITUD, ID_TIPOMARCA, MARCACOLECTIVA, DESCRIPCIONSIGNODISTINTIVO,
    FECHAPRIMERUSO, NOUSADOFECHA, LEYENDASFIGURASRESERVABLES, ID_DOMICILIONOTIFICACION,
    ID_PAISPRIORIDAD, FECHAPRESENTACIONEXTRANJERO, ID_ESTATUS, FECHA_ESTATUS_ACTUAL, ID_USUARIOFIRMANTE, NUMEROEXPEDIENTE,
    FECHARECEPCION, FECHAPRESENTACION, FECHACAPTURA, NUMEROREFEXTRANJERO, ID_USUARIOCAPTURA, HAYPRIORIDAD
    from TRAMITE
    where IND_ACTIVO=1 AND ID_ESTATUS in(1,2,3,4) AND ID_USUARIOCAPTURA=#{idUsuariocaptura,jdbcType=DECIMAL}
    </select>
    <update id="borradoLogico" parameterType="map" >
    update TRAMITE set IND_ACTIVO= #{indActivo}
    where ID_TRAMITE = #{idTramite}
    </update>
    <select id="getTramiteByCriteria" resultMap="BaseResultMap" parameterType="mx.gob.impi.rdu.persistence.model.Tramite" >
    select
    ID_TRAMITE, ID_SUBTIPOSOLICITUD, ID_TIPOMARCA, MARCACOLECTIVA, DESCRIPCIONSIGNODISTINTIVO,
    FECHAPRIMERUSO, NOUSADOFECHA, LEYENDASFIGURASRESERVABLES, ID_DOMICILIONOTIFICACION,
    ID_PAISPRIORIDAD, FECHAPRESENTACIONEXTRANJERO, ID_ESTATUS, FECHA_ESTATUS_ACTUAL, ID_USUARIOFIRMANTE, NUMEROEXPEDIENTE,
    FECHARECEPCION, FECHAPRESENTACION, FECHACAPTURA, NUMEROREFEXTRANJERO, ID_USUARIOCAPTURA, HAYPRIORIDAD
    from TRAMITE
        <where>
            <if test="idTramite != null" >
           ID_TRAMITE = #{idTramite,jdbcType=DECIMAL}
            </if>
            <if test="idSubtiposolicitud != null" >
           AND ID_SUBTIPOSOLICITUD = #{idSubtiposolicitud,jdbcType=DECIMAL}
            </if>
            <if test="idTipomarca != null" >
           AND ID_TIPOMARCA = #{idTipomarca,jdbcType=DECIMAL}
            </if>
            <if test="marcacolectiva != null" >
           AND MARCACOLECTIVA = #{marcacolectiva,jdbcType=DECIMAL}
            </if>
            <if test="fechaprimeruso != null" >
           AND FECHAPRIMERUSO = #{fechaprimeruso,jdbcType=TIMESTAMP}
            </if>
            <if test="idPaisprioridad != null" >
           AND ID_PAISPRIORIDAD = #{idPaisprioridad,jdbcType=DECIMAL}
            </if>
            <if test="fechapresentacionextranjero != null" >
           AND FECHAPRESENTACIONEXTRANJERO = #{fechapresentacionextranjero,jdbcType=TIMESTAMP}
            </if>
        </where>
    </select>
    
    <select id="expedientesByUsuario" parameterType="map" resultMap="BaseResultExpediente">
        <if test="idTipoSolicitud.intValue() == 11 or idTipoSolicitud == 4">
            SELECT
              F.ID_FIRMA,
              F.ID_PATENTE ID_TRAMITE,
              SUBSTR(F.FOLIO,11) AS FOLIO,
              F.EXPEDIENTE_PATENTES EXPEDIENTE,
              F.FECHA_PRESENTACION,
              F.FECHA_REGISTRO,
              SB.DESCRIPCION AS SUBTIPOSOLICITUD,
              T.ID_SUBTIPO_SOLICITUD ID_SUBTIPOSOLICITUD,
              TS.DESCRIPCION AS TIPOSOLICITUD,
              A.DESCRIPCION  AS AREA,
              AN.archivo_anexo,
              null ID_TIPOMARCA,
              F.FECHA_REVISION
            FROM FIRMA F
            INNER JOIN TRAMITE_PATENTE T ON F.ID_PATENTE=T.ID_TRAMITE_PATENTE AND EXPEDIENTE_PATENTES IS NOT NULL
            <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
                        AND T.id_usuario_captura in
                <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
                </foreach>
            </if>
            <if test="fechaInicio!=null and fechaFin!=null">
                        AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
            </if>
            <if test="ultimoMes!=null">
                        AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
            </if>
            <if test="ultimaSemana!=null">
                        AND F.FECHA_PRESENTACION > SYSDATE-7
            </if>
            INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPO_SOLICITUD
            INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
            <if test="idTipoSolicitud!=null">
                        AND TS.ID_TIPOSOLICITUD in(9,10,11,12,20,21)
            </if>
            INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
            <if test="idArea!=null">
                        AND ts.id_area=#{idArea}
            </if>
            LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE AND an.extension='gif' ORDER BY F.FECHA_PRESENTACION DESC
        </if>
        <if test="idTipoSolicitud.intValue() == 1 or idTipoSolicitud == 3">
    SELECT F.ID_FIRMA, F.ID_TRAMITE, substr(F.FOLIO,11) as FOLIO, F.EXPEDIENTE, F.FECHA_PRESENTACION, F.FECHA_REGISTRO, 
            
    SB.DESCRIPCION AS SUBTIPOSOLICITUD, T.ID_SUBTIPOSOLICITUD, TS.DESCRIPCION AS TIPOSOLICITUD, A.DESCRIPCION AS AREA, AN.archivo_anexo
    , T.ID_TIPOMARCA, F.FECHA_REVISION
    FROM FIRMA F
    INNER JOIN TRAMITE T ON F.ID_TRAMITE=T.ID_TRAMITE
            <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
            AND T.id_usuariocaptura in
                <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
                </foreach>
            </if>
            <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
            </if>
            <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
            </if>
            <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
            </if>

    INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPOSOLICITUD
    INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
            <if test="idTipoSolicitud!=null">
            AND TS.ID_TIPOSOLICITUD=#{idTipoSolicitud}
            </if>
    INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
            <if test="idArea!=null">
            AND ts.id_area=#{idArea}
            </if>
    LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE
    and an.extension='gif'
    ORDER BY F.FECHA_PRESENTACION desc
        </if>
    </select>

    <select id="expedienteNotByIdUsuario" resultMap="BaseResultExpediente" parameterType="long">
        SELECT
            ID_FIRMA,
            ID_TRAMITE,
            FOLIO,
            EXPEDIENTE,
            FECHA_PRESENTACION,
            FECHA_REGISTRO,
            ANEXO_XML,
            ACUSE_PDF,
            TIPOSOLICITUD,
            AREA,
            ID_AREA,
            FECHA_REVISION,
            ID_USUARIO_FIRMANTE
       FROM (
            SELECT F.ID_FIRMA,
                NF.ID_NOTIFICACION ID_TRAMITE,
                F.FOLIO FOLIO,
                N.EXPEDIENTE,
                F.FECHA_PRESENTACION,
                F.FECHA_REGISTRO,
                F.ANEXO_XML,
                F.ACUSE_PDF,
                'NOTIFICACIONES' TIPOSOLICITUD,
                A.DESCRIPCION AREA,
                A.ID_AREA ID_AREA,
                F.FECHA_REVISION,
        <if test="idArea == 4 or idArea == 20 " >
                TP.ID_USUARIO_FIRMANTE
        </if>
        <if test=" idArea == 40">
               N.ID_USUARIO_CARGA ID_USUARIO_FIRMANTE
        </if>
        <if test="idArea == 8">
                T.ID_USUARIOFIRMANTE ID_USUARIO_FIRMANTE
        </if>
            FROM FIRMA F
            INNER JOIN NOTIFICACION_FIRMA NF ON(F.ID_FIRMA=NF.ID_FIRMA)
            INNER JOIN NOTIFICACION N ON(N.ID_NOTIFICACION=NF.ID_NOTIFICACION)
            AND N.ID_AREA=#{idArea,jdbcType=DECIMAL}
        <if test="idArea == 4 or idArea == 20 ">
            INNER JOIN TRAMITE_PATENTE TP ON(TP.ID_TRAMITE_PATENTE=F.ID_PATENTE)
        </if>
        <if test="idArea == 8">
            INNER JOIN TRAMITE T ON(T.ID_TRAMITE=F.ID_TRAMITE)
        </if>
            INNER JOIN CAT_AREA A ON(A.ID_AREA=N.ID_AREA)
            )
            WHERE ID_USUARIO_FIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        <if test="fechaInicio!=null and fechaFin!=null">
            AND FECHA_REGISTRO BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND FECHA_REGISTRO > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND FECHA_REGISTRO > SYSDATE-7
        </if>
                
    </select>

    <select id="expedientesPromByIdUsuarioBK" resultMap="BaseResultExpediente" parameterType="long">
         SELECT
              F.ID_FIRMA,
              P.ID_TRAMITE_PROMOCION_MARCA ID_TRAMITE,
              F.ID_PROMOCION,
              F.FOLIO,
              F.EXPEDIENTE,
              F.FECHA_PRESENTACION,
              F.ANEXO_XML,
              F.ACUSE_PDF,
              CT.DESCRIPCION TIPOSOLICITUD,
              CA.ID_AREA ID_AREA,
              CA.DESCRIPCION AREA,
              P.ID_USUARIOFIRMANTE ID_USUARIO_FIRMANTE
        FROM FIRMA F
        INNER JOIN TRAMITE_PROMOCION_MARCA P ON(P.ID_TRAMITE_PROMOCION_MARCA=F.ID_PROMOCION)
        INNER JOIN CAT_SUBTIPOSOLICITUD CS ON(CS.ID_SUBTIPOSOLICITUD=P.ID_SUBTIPOSOLICITUD)
        INNER JOIN CAT_TIPOSOLICITUD CT ON(CS.ID_TIPOSOLICITUD=CT.ID_TIPOSOLICITUD)
        INNER JOIN CAT_AREA CA ON(CT.ID_AREA=CA.ID_AREA)
        WHERE P.ID_USUARIOFIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
            AND CA.ID_AREA=8
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>
    </select>

    <select id="expedientesPromByIdUsuario" resultMap="BaseResultExpediente" parameterType="long">
        SELECT
            F.ID_FIRMA,
            F.ID_PROMOCION,
            F.FOLIO,
            F.EXPEDIENTE,
            F.FECHA_PRESENTACION AS FECHA_PRESENTACION,
            F.ANEXO_XML,
            F.ACUSE_PDF,
        PRO.ID_USUARIOCAPTURA
        FROM FIRMA F
        INNER JOIN tramite_promocion_patente P ON(P.ID_PROMOCION=F.ID_PROMOCION)
        INNER JOIN tramite_promocion PRO ON (P.ID_PROMOCION = PRO.ID_PROMOCION) 
        WHERE PRO.ID_USUARIOCAPTURA in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>
    </select>

    <select id="selectTramite" resultMap="BaseResultMap" >
    select
    ID_TRAMITE, ID_SUBTIPOSOLICITUD, ID_TIPOMARCA, MARCACOLECTIVA, DESCRIPCIONSIGNODISTINTIVO,
    FECHAPRIMERUSO, NOUSADOFECHA, LEYENDASFIGURASRESERVABLES, ID_DOMICILIONOTIFICACION,
    ID_PAISPRIORIDAD, FECHAPRESENTACIONEXTRANJERO, ID_ESTATUS, FECHA_ESTATUS_ACTUAL, ID_USUARIOFIRMANTE, NUMEROEXPEDIENTE,
    FECHARECEPCION, FECHAPRESENTACION, FECHACAPTURA, NUMEROREFEXTRANJERO, ID_USUARIOCAPTURA, HAYPRIORIDAD
    from TRAMITE
    </select>

    <select id="solicitudesByUsuarios" resultMap="BaseResultSolicitudesPreparacion">
        select T.ID_TRAMITE, A.ID_AREA, A.DESCRIPCION  AS DESCRIPCIONAREA, T.ID_SUBTIPOSOLICITUD, SB.DESCRIPCION AS DESCRIPCIONSUBTIPOSOLICITUD,
        SB.ID_TIPOSOLICITUD, TS.DESCRIPCION AS DESCRIPCIONTIPOSOLICITUD, TS.URLSIGACCION AS URL_TIPOSOLICITUD,  
        T.FECHACAPTURA, T.FECHA_ESTATUS_ACTUAL, T.ID_USUARIOCAPTURA, T.ID_USUARIOFIRMANTE, 
        T.ID_ESTATUS, CE.DESCRIPCION AS  DESESTATUS, CE.SIGACCION, CE.URLSIGACCION AS URL_SIG_ACCION_ESTATUS,
        T.ID_TIPOMARCA, t.DESCRIPCIONSIGNODISTINTIVO, T.HAYPRIORIDAD, NVL(SL.TOT_SOLICITANTES,0) AS TOT_SOLICITANTES,
        #{idTipoTramite} as ID_TIPOTRAMITE
        from (select * from TRAMITE where IND_ACTIVO=1 AND ID_ESTATUS in(1,2,3,4) AND ID_USUARIOCAPTURA in 
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
            #{item}
        </foreach>
        ) T
        INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=t.ID_SUBTIPOSOLICITUD
        INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
        INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
        INNER JOIN CAT_ESTATUS CE ON t.ID_ESTATUS=CE.ID_ESTATUS
        LEFT JOIN (SELECT ID_TRAMITE, COUNT(*) AS TOT_SOLICITANTES FROM SOLICITANTE_X_TRAMITE GROUP BY ID_TRAMITE) SL ON t.ID_TRAMITE=SL.ID_TRAMITE 
        ORDER BY t.FECHACAPTURA DESC
    </select>
                  
    <!-- PATENTES 
     Se cambio SB.DESCRIPCION || ' ' ||  T.INVENCION para mostrar Título de la Invención
    -->
    <select id="expedientesPatentesByUsuario" parameterType="map" resultMap="BaseResultExpediente">
        SELECT
              F.ID_FIRMA,    
              F.ID_TRAMITE,          
              SUBSTR(F.FOLIO,11) AS FOLIO,
              F.EXPEDIENTE_PATENTES EXPEDIENTE,
              F.FECHA_PRESENTACION,
              F.FECHA_REGISTRO,
              SB.DESCRIPCION AS SUBTIPOSOLICITUD,
              T.ID_SUBTIPO_SOLICITUD ID_SUBTIPOSOLICITUD,
              TS.DESCRIPCION AS TIPOSOLICITUD,
              SB.DESCRIPCION || ' ' ||  T.INVENCION AS AREA,
            CASE
            WHEN dbms_lob.getlength(ACUSE_PDF) IS NULL
            THEN 0
            ELSE 1
            END AS EXISTE_ACUSE_PDF,
            CASE
            WHEN dbms_lob.getlength(AN.archivo_anexo) IS NULL
            THEN 0
            ELSE 1
            END AS EXISTE_ACUSE_LOGO,
            ENVIO_SIGMAR,                  
            FECHA_ENVIO_SIGMAR,
            F.ENVIO_UCM,
            F.FECHA_ENVIO_UCM                        
            FROM FIRMA F
            INNER JOIN TRAMITE_PATENTE T ON F.ID_PATENTE=T.ID_TRAMITE_PATENTE AND EXPEDIENTE_PATENTES IS NOT NULL
            <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
                        AND T.id_usuario_captura in
                <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
                </foreach>
            </if>
            <if test="fechaInicio!=null and fechaFin!=null">
                        AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
            </if>
            <if test="ultimoMes!=null">
                        AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
            </if>
            <if test="ultimaSemana!=null">
                        AND F.FECHA_PRESENTACION > SYSDATE-7
            </if>
            INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPO_SOLICITUD
            INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
            <if test="idTipoSolicitud!=null">
                        AND TS.ID_TIPOSOLICITUD in(9,10,11,12,20,21)
            </if>
            INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
            <if test="idArea!=null">
                        AND ts.id_area=#{idArea}
            </if>
            LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE AND an.extension='gif' ORDER BY F.FECHA_PRESENTACION DESC
    </select>
    
    <!-- MARCAS-->
    <select id="expedientesMarcasByUsuario" parameterType="map" resultMap="BaseResultExpediente">
        SELECT F.ID_FIRMA,
        F.ID_TRAMITE,                   
        substr(F.FOLIO,11) as FOLIO, 
        F.EXPEDIENTE, 
        F.FECHA_PRESENTACION,
        F.FECHA_REGISTRO,
        SB.DESCRIPCION AS SUBTIPOSOLICITUD,
        T.ID_SUBTIPO_SOLICITUD ID_SUBTIPOSOLICITUD,
        TS.DESCRIPCION AS TIPOSOLICITUD,
        A.DESCRIPCION  AS AREA,                
        F.FECHA_REVISION, 
        CASE
        WHEN dbms_lob.getlength(ACUSE_PDF) IS NULL
        THEN 0
        ELSE 1
        END AS EXISTE_ACUSE_PDF       ,
        CASE
        WHEN dbms_lob.getlength(AN.archivo_anexo) IS NULL
        THEN 0
        ELSE 1
        END AS EXISTE_ACUSE_LOGO        
        FROM FIRMA F
        INNER JOIN TRAMITE T ON F.ID_TRAMITE=T.ID_TRAMITE
        <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
            AND T.id_usuariocaptura in
            <foreach item="item" collection="usuarios"
                         open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>

        INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPOSOLICITUD
        INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
        <if test="idTipoSolicitud!=null">
            AND TS.ID_TIPOSOLICITUD=#{idTipoSolicitud}
        </if>
        INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
        <if test="idArea!=null">
            AND ts.id_area=#{idArea}
        </if>
        LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE
        and an.extension='gif'
        ORDER BY F.FECHA_PRESENTACION desc
    </select>
    
    <!-- Obtener totales de query para utilizar en paginacion -->
    <!-- PATENTES -->
    <select id="obtenerTotalExpedientesPatentesByUsuario" parameterType="map" resultType="Integer">
        SELECT
              COUNT(*) AS TOTAL                      
            FROM FIRMA F
            INNER JOIN TRAMITE_PATENTE T ON F.ID_PATENTE=T.ID_TRAMITE_PATENTE AND EXPEDIENTE_PATENTES IS NOT NULL
            <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
                        AND T.id_usuario_captura in
                <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
                </foreach>
            </if>
            <if test="fechaInicio!=null and fechaFin!=null">
                        AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
            </if>
            <if test="ultimoMes!=null">
                        AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
            </if>
            <if test="ultimaSemana!=null">
                        AND F.FECHA_PRESENTACION > SYSDATE-7
            </if>
            INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPO_SOLICITUD
            INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
            <if test="idTipoSolicitud!=null">
                        AND TS.ID_TIPOSOLICITUD in(9,10,11,12,20,21)
            </if>
            INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
            <if test="idArea!=null">
                        AND ts.id_area=#{idArea}
            </if>
            LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE AND an.extension='gif' ORDER BY F.FECHA_PRESENTACION DESC
    </select>
    
    
    <select id="obtenerAcusePdf" parameterType="java.lang.Long" resultMap = "BaseResulArchivoDigital">
        SELECT ACUSE_PDF ARCHIVO
        FROM FIRMA
        WHERE ID_FIRMA = #{idFirma}        
    </select>
    
      <select id="obtenerAnexoXml" parameterType="java.lang.Long" resultMap = "BaseResulArchivoDigital">
        SELECT ANEXO_XML ARCHIVO
        FROM FIRMA
        WHERE ID_FIRMA = #{idFirma}        
    </select>
    
    <select id="obtenerAcuseLogo" parameterType="java.lang.Long" resultMap = "BaseResulArchivoDigital">
        SELECT ARCHIVO_ANEXO ARCHIVO
        FROM ANEXOS
        WHERE EXTENSION='gif'
        AND ID_TRAMITE = #{idTramite}        
    </select>
    
    
    <!-- querys paginados -->
    
    <!-- PATENTES 
     Se cambio SB.DESCRIPCION || ' ' ||  T.INVENCION para mostrar Título de la Invención
    -->
    <select id="expedientesPatentesPaginadosByUsuario" parameterType="map" resultMap="BaseResultExpediente">
         SELECT *
        FROM
            (SELECT
            /*+ FIRST_ROWS(n) */
            a.* ,
            ROWNUM rnum ,
            COUNT(*) over() AS total_rows
            FROM(        
                SELECT
                F.ID_FIRMA,    
                F.ID_TRAMITE,          
                SUBSTR(F.FOLIO,11) AS FOLIO,
                F.EXPEDIENTE_PATENTES EXPEDIENTE,
                F.FECHA_PRESENTACION,
                F.FECHA_REGISTRO,
                SB.DESCRIPCION AS SUBTIPOSOLICITUD ,             
                TS.DESCRIPCION AS TIPOSOLICITUD,
                SB.DESCRIPCION || ' ' ||  T.INVENCION  AS AREA    ,
                CASE
                WHEN dbms_lob.getlength(ACUSE_PDF) IS NULL
                THEN 0
                ELSE 1
                END AS EXISTE_ACUSE_PDF,
                CASE
                WHEN dbms_lob.getlength(AN.archivo_anexo) IS NULL
                THEN 0
                ELSE 1
                END AS EXISTE_ACUSE_LOGO,
                ENVIO_SIGMAR,                  
                FECHA_ENVIO_SIGMAR,                        
                F.ENVIO_UCM,
                F.FECHA_ENVIO_UCM 
                FROM FIRMA F
                INNER JOIN TRAMITE_PATENTE T ON F.ID_PATENTE=T.ID_TRAMITE_PATENTE AND EXPEDIENTE_PATENTES IS NOT NULL
                <if test="usuarios != null and usuarios.get(0).intValue () > 0" >
                    AND T.id_usuario_captura in
                    <foreach item="item" collection="usuarios"
                                 open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="fechaInicio!=null and fechaFin!=null">
                    AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
                </if>
                <if test="ultimoMes!=null">
                    AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
                </if>
                <if test="ultimaSemana!=null">
                    AND F.FECHA_PRESENTACION > SYSDATE-7
                </if>
                    INNER JOIN CAT_SUBTIPOSOLICITUD SB ON SB.ID_SUBTIPOSOLICITUD=T.ID_SUBTIPO_SOLICITUD
                    INNER JOIN CAT_TIPOSOLICITUD TS ON TS.ID_TIPOSOLICITUD= SB.ID_TIPOSOLICITUD
                <if test="idTipoSolicitud!=null">
                    AND TS.ID_TIPOSOLICITUD in(9,10,11,12,20,21)
                </if>
                INNER JOIN CAT_AREA A ON TS.ID_AREA=A.ID_AREA
                <if test="idArea!=null">
                    AND ts.id_area=#{idArea}
                </if>
                LEFT outer JOIN ANEXOS AN ON F.ID_TRAMITE=AN.ID_TRAMITE AND an.extension='gif' ORDER BY F.FECHA_PRESENTACION DESC                        
            ) a
        ) b
        WHERE b.rnum <![CDATA[> ]]> #{start}
        AND b.rnum   <![CDATA[<=]]> #{maxPerPage}
    </select>
    
    <select id="obtenerExpedientesPromPaginadosByUsuarioBK" resultMap="BaseResultExpediente" parameterType="long">
          SELECT *
        FROM
            (SELECT
            /*+ FIRST_ROWS(n) */
            a.* ,
            ROWNUM rnum ,
            COUNT(*) over() AS total_rows
            FROM(     
         SELECT
              F.ID_FIRMA,
              P.ID_TRAMITE_PROMOCION_MARCA ID_TRAMITE,
              F.ID_PROMOCION,
              F.FOLIO,
              F.EXPEDIENTE,
              F.FECHA_PRESENTACION,
              F.ANEXO_XML,
              F.ACUSE_PDF,         
              CT.DESCRIPCION TIPOSOLICITUD,
              CA.ID_AREA ID_AREA,
              CA.DESCRIPCION AREA,
              P.ID_USUARIOFIRMANTE ID_USUARIO_FIRMANTE
        FROM FIRMA F
        INNER JOIN TRAMITE_PROMOCION_MARCA P ON(P.ID_TRAMITE_PROMOCION_MARCA=F.ID_PROMOCION)
        INNER JOIN CAT_SUBTIPOSOLICITUD CS ON(CS.ID_SUBTIPOSOLICITUD=P.ID_SUBTIPOSOLICITUD)
        INNER JOIN CAT_TIPOSOLICITUD CT ON(CS.ID_TIPOSOLICITUD=CT.ID_TIPOSOLICITUD)
        INNER JOIN CAT_AREA CA ON(CT.ID_AREA=CA.ID_AREA)
        WHERE P.ID_USUARIOFIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
            AND CA.ID_AREA=8
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>
           ) a
        ) b
        WHERE b.rnum <![CDATA[> ]]> #{start}
        AND b.rnum   <![CDATA[<=]]> #{maxPerPage}
    </select>
    
    <select id="obtenerExpedientesPromPaginadosByUsuario" resultMap="BaseResultExpediente" parameterType="long">
          SELECT *
        FROM
            (SELECT
            a.* ,
            ROWNUM rnum ,
            COUNT(*) over() AS total_rows
            FROM(     
         SELECT
              F.ID_FIRMA,
              'Promoción' AS TIPOSOLICITUD,
              F.ID_PROMOCION,
              F.FOLIO AS EXPEDIENTE,
              F.EXPEDIENTE AS FOLIO,
              F.FECHA_PRESENTACION, F.FECHA_REGISTRO,
              TP.DESCRIPCION AS SUBTIPOSOLICITUD ,
              F.ANEXO_XML,
              F.ACUSE_PDF,         
              PRO.ID_USUARIOCAPTURA, P.AREA
        FROM FIRMA F
        INNER JOIN tramite_promocion_patente P ON(P.ID_PROMOCION=F.ID_PROMOCION)
        INNER JOIN tramite_promocion PRO ON (P.ID_PROMOCION = PRO.ID_PROMOCION)
        INNER JOIN cat_tipo_promocion_patente TP ON (P.ID_TIPO_PROMOCION_PATENTE = TP.ID_TIPO_PROMOCION_PATENTE)  
        WHERE PRO.ID_USUARIOCAPTURA in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>
           ) a
        ) b
        WHERE b.rnum <![CDATA[> ]]> #{start}
        AND b.rnum   <![CDATA[<=]]> #{maxPerPage}
    </select>
    
    <select id="obtenerExpedientesNotPaginadosByUsuario" resultMap="BaseResultExpediente" parameterType="long">
          SELECT *
        FROM
            (SELECT
            /*+ FIRST_ROWS(n) */
            a.* ,
            ROWNUM rnum ,
            COUNT(*) over() AS total_rows
            FROM( 
        SELECT
            ID_FIRMA,
            ID_TRAMITE,
            FOLIO,
            EXPEDIENTE,
            FECHA_PRESENTACION,
            FECHA_REGISTRO,
            ANEXO_XML,
            ACUSE_PDF,
            TIPOSOLICITUD,
            AREA,
            ID_AREA,
            FECHA_REVISION,
            ID_USUARIO_FIRMANTE           
       FROM (
            SELECT F.ID_FIRMA,
                NF.ID_NOTIFICACION ID_TRAMITE,
                F.FOLIO FOLIO,
                N.EXPEDIENTE,
                F.FECHA_PRESENTACION,
                F.FECHA_REGISTRO,
                F.ANEXO_XML,
                F.ACUSE_PDF,
                'NOTIFICACIONES' TIPOSOLICITUD,
                A.DESCRIPCION AREA,
                A.ID_AREA ID_AREA,
                F.FECHA_REVISION,
       
        <if test=" idArea == 4 or idArea == 20 ">
                TP.ID_USUARIO_FIRMANTE
        </if>
        <if test=" idArea == 40">
               N.ID_USUARIO_CARGA ID_USUARIO_FIRMANTE
        </if>
        <if test="idArea == 8">
                T.ID_USUARIOFIRMANTE ID_USUARIO_FIRMANTE
        </if>
            FROM FIRMA F
            INNER JOIN NOTIFICACION_FIRMA NF ON(F.ID_FIRMA=NF.ID_FIRMA)
            INNER JOIN NOTIFICACION N ON(N.ID_NOTIFICACION=NF.ID_NOTIFICACION)
            AND N.ID_AREA=#{idArea,jdbcType=DECIMAL}
        <if test=" idArea == 4 or idArea == 20 ">
            INNER JOIN TRAMITE_PATENTE TP ON(TP.ID_TRAMITE_PATENTE=F.ID_PATENTE)
        </if>
        <if test="idArea == 8">
            INNER JOIN TRAMITE T ON(T.ID_TRAMITE=F.ID_TRAMITE)
        </if>
            INNER JOIN CAT_AREA A ON(A.ID_AREA=N.ID_AREA)
            )
            WHERE ID_USUARIO_FIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        <if test="fechaInicio!=null and fechaFin!=null">
            AND FECHA_REGISTRO BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND FECHA_REGISTRO > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND FECHA_REGISTRO > SYSDATE-7
        </if>        
            ) a
        ) b
        WHERE b.rnum <![CDATA[> ]]> #{start}
        AND b.rnum   <![CDATA[<=]]> #{maxPerPage}
    </select>
    
    <select id="obtenerTotalExpedientesNot" parameterType="map" resultType="Integer">        
            SELECT
           COUNT(*) AS TOTAL
       FROM (
            SELECT F.ID_FIRMA,
                NF.ID_NOTIFICACION ID_TRAMITE,
                F.FOLIO FOLIO,
                N.EXPEDIENTE,
                F.FECHA_PRESENTACION,
                F.FECHA_REGISTRO,
                F.ANEXO_XML,
                F.ACUSE_PDF,
                'NOTIFICACIONES' TIPOSOLICITUD,
                A.DESCRIPCION AREA,
                A.ID_AREA ID_AREA,
                F.FECHA_REVISION,
        <if test=" idArea == 4 or idArea == 20 ">
                TP.ID_USUARIO_FIRMANTE
        </if>
        <if test=" idArea == 40">
               N.ID_USUARIO_CARGA ID_USUARIO_FIRMANTE
        </if>
        <if test="idArea == 8">
                T.ID_USUARIOFIRMANTE ID_USUARIO_FIRMANTE
        </if>
            FROM FIRMA F
            INNER JOIN NOTIFICACION_FIRMA NF ON(F.ID_FIRMA=NF.ID_FIRMA)
            INNER JOIN NOTIFICACION N ON(N.ID_NOTIFICACION=NF.ID_NOTIFICACION)
            AND N.ID_AREA=#{idArea,jdbcType=DECIMAL}
        <if test=" idArea == 4 or idArea == 20 ">
            INNER JOIN TRAMITE_PATENTE TP ON(TP.ID_TRAMITE_PATENTE=F.ID_PATENTE)
        </if>
        <if test="idArea == 8">
            INNER JOIN TRAMITE T ON(T.ID_TRAMITE=F.ID_TRAMITE)
        </if>
            INNER JOIN CAT_AREA A ON(A.ID_AREA=N.ID_AREA)
            )
            WHERE ID_USUARIO_FIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        <if test="fechaInicio!=null and fechaFin!=null">
            AND FECHA_REGISTRO BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND FECHA_REGISTRO > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND FECHA_REGISTRO > SYSDATE-7
        </if>
    </select>
    
    <select id="obtenerTotalExpedientesPromBK" parameterType="map" resultType="Integer">
        
        SELECT
              COUNT(*) AS TOTAL 
        FROM FIRMA F
        INNER JOIN TRAMITE_PROMOCION_MARCA P ON(P.ID_TRAMITE_PROMOCION_MARCA=F.ID_PROMOCION)
        INNER JOIN CAT_SUBTIPOSOLICITUD CS ON(CS.ID_SUBTIPOSOLICITUD=P.ID_SUBTIPOSOLICITUD)
        INNER JOIN CAT_TIPOSOLICITUD CT ON(CS.ID_TIPOSOLICITUD=CT.ID_TIPOSOLICITUD)
        INNER JOIN CAT_AREA CA ON(CT.ID_AREA=CA.ID_AREA)
        WHERE P.ID_USUARIOFIRMANTE in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
            AND CA.ID_AREA=20
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>        
    </select>
    
    <select id="obtenerTotalExpedientesProm" parameterType="map" resultType="Integer">
        
        SELECT
              COUNT(*) AS TOTAL 
        FROM FIRMA F
        INNER JOIN tramite_promocion_patente P ON(P.ID_PROMOCION=F.ID_PROMOCION)
        INNER JOIN tramite_promocion PRO ON (P.ID_PROMOCION = PRO.ID_PROMOCION)
        WHERE PRO.ID_USUARIOCAPTURA in
        <foreach item="item" collection="usuarios"
                 open="(" separator="," close=")">
                           #{item}
        </foreach>
        
        <if test="fechaInicio!=null and fechaFin!=null">
            AND F.FECHA_PRESENTACION BETWEEN TO_DATE(#{fechaInicio},'DD-MM-YYYY') AND TO_DATE(#{fechaFin}||' 23:59:59','DD-MM-YYYY hh24:mi:ss')
        </if>
        <if test="ultimoMes!=null">
            AND F.FECHA_PRESENTACION > add_months(SYSDATE,-1)
        </if>
        <if test="ultimaSemana!=null">
            AND F.FECHA_PRESENTACION > SYSDATE-7
        </if>        
    </select>


</mapper>
